document.addEventListener("DOMContentLoaded",(()=>{let bannerSubscribeForm=document.querySelector("#bannersubscribeform");if(null!==bannerSubscribeForm){const bannerSubscribeFormButton=document.querySelector("#bannersubscribeform button");var bannerSubscribeFormAlert=document.createElement("div");bannerSubscribeFormAlert.setAttribute("class","alert"),bannerSubscribeFormAlert.setAttribute("aria-live","assertive"),bannerSubscribeFormAlert.setAttribute("aria-atomic","true"),bannerSubscribeForm.appendChild(bannerSubscribeFormAlert),bannerSubscribeForm.onsubmit=async event=>{if(event.preventDefault(),bannerSubscribeForm.elements.snarefortheunwary.value)return;const formdata=new FormData(bannerSubscribeForm),email=formdata.get("email").trim();if(!email)return showAlert("Please enter your email address","Not sent"),bannerSubscribeFormAlert.addEventListener("click",retryAlertHandler),void bannerSubscribeFormAlert.addEventListener("keydown",retryAlertHandler);if(!function(email){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)}(email))return showAlert("Please enter a valid email address","Not sent"),bannerSubscribeFormAlert.addEventListener("click",retryAlertHandler),void bannerSubscribeFormAlert.addEventListener("keydown",retryAlertHandler);bannerSubscribeFormButton.disabled=!0,bannerSubscribeFormButton.textContent="Sending ...";try{const response=await fetch("https://sc8pprwk2k.execute-api.eu-west-2.amazonaws.com/dev/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(formdata))});418===response?showAlert("Your email address is already on The Exeter Digest mailing list","Sent"):response.ok?showAlert("Thanks for subscribing to The Exeter Digest: the next edition will be with you soon","Sent"):showAlert("There was a problem submitting your email address: please try again","Not sent")}catch(error){console.error("Error submitting form:",error)}function showAlert(alertMessage,buttonText){bannerSubscribeFormAlert.innerHTML=`<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20"><path stroke-width="1" d="M16,16 L4,4"/><path stroke-width="1" d="M16,4 L4,16"/></svg><p>${alertMessage}</p></div>`,bannerSubscribeFormAlert.setAttribute("role","button"),bannerSubscribeFormAlert.setAttribute("tabindex","0"),bannerSubscribeFormAlert.focus(),bannerSubscribeFormButton.disabled=!0,bannerSubscribeFormButton.textContent=`${buttonText}`}function retryAlertHandler(event){"click"!==event.type&&("keydown"!==event.type||"Enter"!==event.key&&" "!==event.key)||(bannerSubscribeFormAlert.innerHTML="",bannerSubscribeFormButton.disabled=!1,bannerSubscribeFormButton.textContent="Subscribe free",bannerSubscribeFormAlert.removeEventListener("click",retryAlertHandler),bannerSubscribeFormAlert.removeEventListener("keydown",retryAlertHandler))}function resetAlertHandler(event){"click"!==event.type&&("keydown"!==event.type||"Enter"!==event.key&&" "!==event.key)||(bannerSubscribeFormAlert.innerHTML="",bannerSubscribeFormButton.disabled=!1,bannerSubscribeFormButton.textContent="Subscribe free",bannerSubscribeForm.reset(),bannerSubscribeFormAlert.removeEventListener("click",resetAlertHandler),bannerSubscribeFormAlert.removeEventListener("keydown",resetAlertHandler))}bannerSubscribeFormAlert.addEventListener("click",resetAlertHandler),bannerSubscribeFormAlert.addEventListener("keydown",resetAlertHandler)}}let insertSubscribeForm=document.querySelector("#insertsubscribeform");if(null!==insertSubscribeForm){const insertSubscribeFormButton=document.querySelector("#insertsubscribeform button");var insertSubscribeFormAlert=document.createElement("div");insertSubscribeFormAlert.setAttribute("class","alert"),insertSubscribeFormAlert.setAttribute("aria-live","assertive"),insertSubscribeFormAlert.setAttribute("aria-atomic","true"),insertSubscribeForm.appendChild(insertSubscribeFormAlert),insertSubscribeForm.onsubmit=async event=>{if(event.preventDefault(),insertSubscribeForm.elements.snarefortheunwary.value)return;const formdata=new FormData(insertSubscribeForm),email=formdata.get("email").trim();if(!email)return showAlert("Please enter your email address","Not sent"),insertSubscribeFormAlert.addEventListener("click",retryAlertHandler),void insertSubscribeFormAlert.addEventListener("keydown",retryAlertHandler);if(!function(email){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)}(email))return showAlert("Please enter a valid email address","Not sent"),insertSubscribeFormAlert.addEventListener("click",retryAlertHandler),void insertSubscribeFormAlert.addEventListener("keydown",retryAlertHandler);insertSubscribeFormButton.disabled=!0,insertSubscribeFormButton.textContent="Sending ...";try{const response=await fetch("https://sc8pprwk2k.execute-api.eu-west-2.amazonaws.com/dev/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(formdata))});418===response?showAlert("Your email address is already on The Exeter Digest mailing list","Sent"):response.ok?showAlert("Thanks for subscribing to The Exeter Digest: the next edition will be with you soon","Sent"):showAlert("There was a problem submitting your email address: please try again","Not sent")}catch(error){console.error("Error submitting form:",error)}function showAlert(alertMessage,buttonText){insertSubscribeFormAlert.innerHTML=`<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20"><path stroke-width="1" d="M16,16 L4,4"/><path stroke-width="1" d="M16,4 L4,16"/></svg><p>${alertMessage}</p></div>`,insertSubscribeFormAlert.setAttribute("role","button"),insertSubscribeFormAlert.setAttribute("tabindex","0"),insertSubscribeFormAlert.focus(),insertSubscribeFormButton.disabled=!0,insertSubscribeFormButton.textContent=`${buttonText}`}function retryAlertHandler(event){"click"!==event.type&&("keydown"!==event.type||"Enter"!==event.key&&" "!==event.key)||(insertSubscribeFormAlert.innerHTML="",insertSubscribeFormButton.disabled=!1,insertSubscribeFormButton.textContent="Subscribe free",insertSubscribeFormAlert.removeEventListener("click",retryAlertHandler),insertSubscribeFormAlert.removeEventListener("keydown",retryAlertHandler))}function resetAlertHandler(event){"click"!==event.type&&("keydown"!==event.type||"Enter"!==event.key&&" "!==event.key)||(insertSubscribeFormAlert.innerHTML="",insertSubscribeFormButton.disabled=!1,insertSubscribeFormButton.textContent="Subscribe free",insertSubscribeForm.reset(),insertSubscribeFormAlert.removeEventListener("click",resetAlertHandler),insertSubscribeFormAlert.removeEventListener("keydown",resetAlertHandler))}insertSubscribeFormAlert.addEventListener("click",resetAlertHandler),insertSubscribeFormAlert.addEventListener("keydown",resetAlertHandler)}}}));